{
	"info": {
		"_postman_id": "c6a0c893-e9af-d3a4-83f4-ec972444dcda",
		"name": "AppatellaResearchAPI Unit Test",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "bad requests",
			"description": "",
			"item": [
				{
					"name": "/reserveExport/",
					"description": "",
					"item": [
						{
							"name": "reserveExport badSecret0",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "fa518864-52d8-4a51-826d-4c6a42ab323a",
										"type": "text/javascript",
										"exec": [
											"pm.test(\"badSecret0\", function () {",
											"    pm.response.to.have.status(400);",
											"});"
										]
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "370b3f48-c39a-467e-ac93-6a70b9613f29",
										"type": "text/javascript",
										"exec": [
											"pm.globals.set(\"badSecret0\",\"no spaces!\");"
										]
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"body": {},
								"url": {
									"raw": "{{endpoint}}/reserveExport/?secret={{badSecret0}}",
									"host": [
										"{{endpoint}}"
									],
									"path": [
										"reserveExport",
										""
									],
									"query": [
										{
											"key": "secret",
											"value": "{{badSecret0}}"
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "reserveExport badSecret1",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "9d8956d3-6460-4af1-846f-376458bf5d33",
										"type": "text/javascript",
										"exec": [
											"pm.test(\"badSecret1\", function () {",
											"    pm.response.to.have.status(400);",
											"});"
										]
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "616d6e87-8121-4a6d-8cdc-0da0b7578ed3",
										"type": "text/javascript",
										"exec": [
											"pm.globals.set(\"badSecret1\",\"ts\"); //too short"
										]
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"body": {},
								"url": {
									"raw": "{{endpoint}}/reserveExport/?secret={{badSecret1}}",
									"host": [
										"{{endpoint}}"
									],
									"path": [
										"reserveExport",
										""
									],
									"query": [
										{
											"key": "secret",
											"value": "{{badSecret1}}"
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "reserveExport badSecret2",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "7007b0e8-9d29-49b3-9956-8dea27dbfe43",
										"type": "text/javascript",
										"exec": [
											"pm.test(\"badSecret2\", function () {",
											"    pm.response.to.have.status(400);",
											"});"
										]
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "98602764-e27f-44b6-96e2-c575dd64021c",
										"type": "text/javascript",
										"exec": [
											"pm.globals.set(\"badSecret2\",\"\"); //empty"
										]
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"body": {},
								"url": {
									"raw": "{{endpoint}}/reserveExport/?secret={{badSecret2}}",
									"host": [
										"{{endpoint}}"
									],
									"path": [
										"reserveExport",
										""
									],
									"query": [
										{
											"key": "secret",
											"value": "{{badSecret2}}"
										}
									]
								}
							},
							"response": []
						}
					],
					"_postman_isSubFolder": true
				},
				{
					"name": "/requestExport/",
					"description": "",
					"item": [
						{
							"name": "requestExport badRequestId0",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "b8cf4deb-5060-46cf-ace8-af26380d52ef",
										"type": "text/javascript",
										"exec": [
											"pm.test(\"badRequestId0\", function () {",
											"    pm.response.to.have.status(400);",
											"});"
										]
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "0607eb4a-3e03-4c1d-83a6-360181405083",
										"type": "text/javascript",
										"exec": [
											"pm.globals.set(\"badRequestId0\",\"probablyNotAnId\");"
										]
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"body": {},
								"url": {
									"raw": "{{endpoint}}/requestExport/?secret={{badRequestId0}}",
									"host": [
										"{{endpoint}}"
									],
									"path": [
										"requestExport",
										""
									],
									"query": [
										{
											"key": "secret",
											"value": "{{badRequestId0}}"
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "requestExport badRequestId1",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "5194ac1d-013a-46af-abf9-7fc9b813ea5f",
										"type": "text/javascript",
										"exec": [
											"pm.test(\"badRequestId1\", function () {",
											"    pm.response.to.have.status(400);",
											"});"
										]
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "8dde9dcc-2369-4730-b778-691fa339fef0",
										"type": "text/javascript",
										"exec": [
											"pm.globals.set(\"badRequestId1\",\"\");"
										]
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"body": {},
								"url": {
									"raw": "{{endpoint}}/requestExport/?secret={{badRequestId1}}",
									"host": [
										"{{endpoint}}"
									],
									"path": [
										"requestExport",
										""
									],
									"query": [
										{
											"key": "secret",
											"value": "{{badRequestId1}}"
										}
									]
								}
							},
							"response": []
						}
					],
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "376ffa20-b561-4ed0-8737-187e48ebe810",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"id": "b3c83545-9838-4de9-9a45-2a4db6634737",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					],
					"_postman_isSubFolder": true
				}
			]
		},
		{
			"name": "good requests",
			"description": "",
			"item": [
				{
					"name": "reserveExport",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "a50a1381-f0d6-4f0f-8b80-e3b7a2844880",
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"    if(pm.response.code === 200){",
									"        var jsonData = pm.response.json();",
									"        pm.globals.set(\"exportRequestId\", jsonData.exportRequestId);        ",
									"    }",
									"});",
									"",
									"/*",
									"const endpoint = pm.globals.get(\"endpoint\");",
									"// /reserveExport/",
									"    let req = \"/reserveExport/\";",
									"    ",
									"    let badSecret0 = \"no spaces!\";",
									"    let badSecret1 = \"ts\"; //too short!",
									"    let badSecret2 = \"\";",
									"    ",
									"    // badSecret0",
									"    pm.sendRequest(endpoint + req + \"?secret=\" + badSecret0, function(err, response) {",
									"        pm.test(req+\" badSecret0\", function(){",
									"            pm.expect(response.code).to.equal(400);",
									"        });",
									"    });",
									"    ",
									"    // badSecret1",
									"    pm.sendRequest(endpoint + req + \"?secret=\" + badSecret1, function(err, response) {",
									"        pm.test(req+\" badSecret1\", function(){",
									"            pm.expect(response.code).to.equal(400);",
									"        });",
									"    });",
									"    ",
									"    // badSecret2",
									"    pm.sendRequest(endpoint + req + \"?secret=\" + badSecret2, function(err, response) {",
									"        pm.test(req+\" badSecret2\", function(){",
									"            pm.expect(response.code).to.equal(400);",
									"        });",
									"    });",
									"    */"
								]
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "3d69fea7-b403-45e3-9922-6d6f33939070",
								"type": "text/javascript",
								"exec": [
									"pm.globals.set(\"goodSecret\", \"secret\"+new Date().getTime());"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"body": {},
						"url": {
							"raw": "{{endpoint}}/reserveExport/?secret={{goodSecret}}",
							"host": [
								"{{endpoint}}"
							],
							"path": [
								"reserveExport",
								""
							],
							"query": [
								{
									"key": "secret",
									"value": "{{goodSecret}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "requestExport",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "fc941639-7dfe-4739-9f1f-4269bc5e032b",
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"body": {},
						"url": {
							"raw": "{{endpoint}}/requestExport/?exportRequestId={{exportRequestId}}",
							"host": [
								"{{endpoint}}"
							],
							"path": [
								"requestExport",
								""
							],
							"query": [
								{
									"key": "exportRequestId",
									"value": "{{exportRequestId}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "exportProgress",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "8ee89724-144d-49ee-8396-6cabd3da78bc",
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"    if(pm.response.code === 200){",
									"        var jsonData = pm.response.json();",
									"        if(jsonData.fileId === undefined){",
									"            //keep getting progress until a file is available",
									"            setNextRequest(exportProgress);",
									"        } else {",
									"            //have fileId",
									"            pm.globals.set(\"fileId\", json.fileId);",
									"        }",
									"    }",
									"});",
									"",
									"const endpoint = pm.globals.get(\"endpoint\");",
									"let req = \"/exportProgress/\";",
									"",
									"let badReqId0 = \"\";",
									"pm.sendRequest(endpoint+req+\"?exportRequestId=\"+badReq0, function (err, response) {",
									"    pm.expect(response.code).to.equal(400);",
									"});",
									"",
									"let badReqId1 = \"notAnID\";",
									"pm.sendRequest(endpoint+req+\"?exportRequestId=\"+badReq1, function (err, response) {",
									"    pm.expect(response.code).to.equal(400);",
									"});",
									"",
									"pm.test(\"Your test name\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.value).to.eql(100);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"body": {},
						"url": {
							"raw": "{{endpoint}}/exportProgress/?exportRequestId={{exportRequestId}}",
							"host": [
								"{{endpoint}}"
							],
							"path": [
								"exportProgress",
								""
							],
							"query": [
								{
									"key": "exportRequestId",
									"value": "{{exportRequestId}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "export",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "5d277937-1565-4444-9681-83b9becda41d",
								"type": "text/javascript",
								"exec": [
									"pm.test(\"file exported?\", function () {",
									"    // ?",
									"});",
									"",
									"",
									"",
									"const endpoint = pm.globals.get(\"endpoint\");",
									"let req = \"/export/\";",
									"",
									"let badReqId0 = \"\";",
									"pm.sendRequest(endpoint+req+\"?fileId=\"+badReq0, function (err, response) {",
									"    pm.expect(response.code).to.equal(400);",
									"});",
									"",
									"let badReqId1 = \"notAnID\";",
									"pm.sendRequest(endpoint+req+\"?fileId=\"+badReq1, function (err, response) {",
									"    pm.expect(response.code).to.equal(400);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"body": {},
						"url": {
							"raw": "{{endpoint}}/export/?fileId={{fileId}}",
							"host": [
								"{{endpoint}}"
							],
							"path": [
								"export",
								""
							],
							"query": [
								{
									"key": "fileId",
									"value": "{{fileId}}"
								}
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"auth": {
		"type": "oauth2",
		"oauth2": [
			{
				"key": "accessToken",
				"value": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6Ik9ETXdNRGc0TlRZME5rWXhSRGd4TnpjeU56SXpOMEl3TVRVNE16STJOelU1UWtJeFJEaEROQSJ9.eyJodHRwczovL3d3dy5hcHBhdGVsbGEub3JnL3VzZXIvdXNlcm5hbWUiOiJhdXRoMHw1OTM4MTBmYjU2OGQ4NDM1ZWFlMzBmNDciLCJpc3MiOiJodHRwczovL2FwcGF0ZWxsYS5ldS5hdXRoMC5jb20vIiwic3ViIjoiYXV0aDB8NTkzODEwZmI1NjhkODQzNWVhZTMwZjQ3IiwiYXVkIjoiaHR0cHM6Ly93d3cuYXBwYXRlbGxhLm9yZy91c2VyIiwiaWF0IjoxNTI0MTUxMjYzLCJleHAiOjE1MjQxNTg0NjMsImF6cCI6IjBNb2VvUVNyREJJWUYxUDVBZ2ZJQ1hqcVRzVmZJNHJ3Iiwic2NvcGUiOiJyZXNlYXJjaGVyIn0.gRxnGWmT9wKOueUrop2rHg1JWbi03gzX-Y2MZiwVoiIXnLTXn1EYDnLAm6BY_aicvwO8E-Fs-3gL_fC9j4ALAvalpLxht8U1V-QZzIyTYsnXH_6lQwu_B4_O73q3sKaH8u8VZcais_JAGlJl1Mp7etYwqndJap0x2tl63Rhq7eJBDyfvMRJaXMkJbmgb1l_9KR-nz5d_y6d7CmY0CoehuekgtmTCY93I_iqYYWm2-QxtvQAtavCO9dXOQ2DeJBPXaSMauZjItFDMufImPmUTwWObq0ENa5jqHUnTo5Mww1lvWuwv04crPS3w7W_F0yH39e58NFXu4uYbzzteRFmTZA",
				"type": "string"
			},
			{
				"key": "tokenType",
				"value": "Bearer",
				"type": "string"
			},
			{
				"key": "addTokenTo",
				"value": "header",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "5c051f8f-1adb-40c0-8651-eb925b1cb9e4",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "7e17ecd9-5348-4648-9bf6-1da8295003ac",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	]
}